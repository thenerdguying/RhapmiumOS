<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="Bonus/OS First Icon.png">
<title>Desktop</title>
<style>
* {
  margin: 0;
  padding: 0;  
  box-sizing: border-box;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  height: 100vh;
  background: #333;
  color: white;
  overflow: hidden;
}

.desktop {
  height: calc(100vh - 40px);
  position: relative;
  background-image: url('Wallpapers/Wallpaper.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.taskbar {
  height: 40px;
  background: #222;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  padding: 0 10px;
  z-index: 1000;
}

.taskbar.hidden {
  display: none !important;
}

.launcher-btn {
  background: #444;
  color: white;
  border: none;
  padding: 5px 15px;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.launcher-btn:hover {
  background: #555;
}

.launcher-menu {
  position: absolute;
  bottom: 40px;
  left: 0;
  background: rgba(34, 34, 34, 0.95);
  width: 1300px;
  border-radius: 8px 8px 0 0;
  padding: 85px;
  display: none;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.launcher-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  cursor: pointer;
  border-radius: 4px;
}

.launcher-item:hover {
  background: #444;
}

.launcher-icon {
  width: 24px;
  height: 24px;
}

.clock {
  margin-left: auto;
  padding: 0 15px;
}

.app {
  width: 800px;
  height: 600px;
  background: white;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 8px;
  overflow: hidden;
  display: none;
  transform-origin: top left;
  touch-action: none;
}

.app.fullscreen {
  width: 100vw !important;
  height: 100vh !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  transform: none !important;
  border-radius: 0 !important;
  z-index: 9999 !important;
}

.title-bar {
  background: #222;
  height: 32px;
  display: flex;
  align-items: center;
  padding: 0 10px;
  cursor: move;
}

.title-bar .fullscreen-btn {
  background: #CBC3E3;
  margin-right: 8px;
}

.title {
  color: white;
  flex: 1;
}

.controls {
  display: flex;
  gap: 8px;
}

.control-button {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
}

.control-button.fullscreen-btn {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  background: #CBC3E3;
}

.minimize {
  background: #ffbd44;
}

.maximize {
  background: #00ca4e;
}

.close {
  background: #ff605c;
}

.iframe-container {
  width: 100%;
  height: calc(100% - 32px);
  background: white;
}

iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.save-load {
  display: flex;
  gap: 10px;
  margin-right: 15px;
}

.save-load button {
  padding: 5px 10px;
  border: none;
  border-radius: 4px;
  background: #444;
  color: white;
  cursor: pointer;
}

.save-load button:hover {
  background: #555;
}

.import-btn {
  background: transparent;  
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 2px 8px;
  border-radius: 4px;
  margin-right: 20px;
  position: relative;
  z-index: 1;
}

.import-btn:hover {
  background: rgba(255,255,255,0.1);
}

.export-btn {
  background: transparent;
  border: none; 
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 2px 8px;
  border-radius: 4px;
  margin-right: 10px;
}

.export-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* Files App Styles */
.files-container {
  display: flex;
  height: calc(100% - 32px);
}

.sidebar {
  width: 200px;
  background: #f5f5f5;
  padding: 10px;
}

.content {
  flex: 1;
  background: white;
  padding: 20px;
  overflow-y: auto;
}

.sidebar-item {
  padding: 8px;
  margin-bottom: 4px;
  cursor: pointer;
  border-radius: 4px;
}

.sidebar-item:hover {
  background: #e0e0e0;
}

.sidebar-item.selected {
  background: #e0e0e0;
}

.files-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 20px;
}

.file-item {
  text-align: center;
  cursor: pointer;
  padding: 10px;
  border-radius: 8px;
  transition: background-color 0.2s;
}

.file-item:hover {
  background-color: rgba(128, 128, 128, 0.1);
}

.file-icon {
  width: 48px;
  height: 48px;
  margin-bottom: 5px;
  transition: transform 0.2s;
}

.file-item:hover .file-icon {
  transform: scale(1.1);
}

.file-name {
  font-size: 12px;
  word-wrap: break-word;
  max-width: 100px;
  margin: 0 auto;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.file-meta {
  font-size: 10px;
  color: #666;
}

/* Dark Mode Styles */
.files-container.dark-mode .sidebar {
  background: #2c2c2c;
  color: #fff;
}

.files-container.dark-mode .content {
  background: #1e1e1e;
  color: #fff;
}

.files-container.dark-mode .sidebar-item {
  color: #fff;
}

.files-container.dark-mode .sidebar-item:hover,
.files-container.dark-mode .sidebar-item.selected {
  background: #3c3c3c;
}

.files-container.dark-mode .file-name {
  color: #fff;
}

/* Dark Mode Toggle Button Styles */
.dark-mode-toggle {
  position: absolute;
  top: 5px;
  right: 160px; 
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 2px 8px;
  border-radius: 4px;
}

.dark-mode-toggle:hover {
  background: rgba(255, 255, 255, 0.1);
}

.file-viewer {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
}

.viewer-overlay {
  background: rgba(0, 0, 0, 0.8);
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.viewer-content {
  max-width: 90%;
  max-height: 90vh;
  position: relative;
  background: white;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.viewer-content > *:not(button) {
  flex: 1;
  min-height: 0;
  overflow: auto;
}

.file-viewer pre {
  margin: 0;
  max-height: 80vh;
}

.file-viewer embed,
.file-viewer iframe {
  min-height: 80vh;
}

.gallery-container img,
.gallery-container video {
  max-height: calc(100vh - 100px);
}

.gallery-container audio {
  margin: 20px;
}

/* Browser Toolbar Styles */
.browser-toolbar {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  background: #f5f5f5;
  border-bottom: 1px solid #ddd;
}

.url-bar {
  flex: 1;
  padding: 6px 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  outline: none;
}

.url-bar:focus {
  border-color: #888;
}

.nav-button {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  background: #eee;
  cursor: pointer;
}

.nav-button:hover {
  background: #ddd;
}

/* Settings App Styles */
.settings-container {
  display: flex;
  height: calc(100% - 32px);
  background: #f5f5f5;
}

.settings-sidebar {
  width: 250px;
  background: #fff;
  border-right: 1px solid #ddd;
  padding: 16px;
}

.settings-section {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 4px;
  cursor: pointer;
  color: #333;
}

.settings-section:hover {
  background: #f0f0f0;
}

.settings-section.active {
  background: #ffffff;
  color: #CBC3E3;
}

.settings-icon {
  width: 24px;
  height: 24px;
}

.settings-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.settings-section-content {
  max-width: 800px;
}

.settings-section-content h2 {
  margin-bottom: 24px;
  color: #333;
}

.settings-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-radius: 8px;
  background: #fff;
  margin-bottom: 16px;
}

.settings-item-label {
  flex: 1;
}

.settings-description {
  font-size: 13px;
  color: #666;
  margin-top: 4px;
}

/* Switch Toggle */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #CBC3E3;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.settings-select {
  padding: 8px;
  border-radius: 4px;
  border: 1px solid #ddd;
  background: #fff;
  cursor: pointer;
}

.settings-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  background: #CBC3E3;
  color: white;
  cursor: pointer;
}

.settings-button:hover {
  background: #1557b0;
}

/* Login Screen Styles */
.login-screen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #CBC3E3; 
  z-index: 10000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
}

.login-form {
  background: rgba(255, 255, 255, 0.05); 
  padding: 40px;
  border-radius: 8px;
  backdrop-filter: blur(10px);
  width: 320px;
  text-align: center;
}

.chrome-logo {
  width: 72px;
  height: 72px;
  margin-bottom: 20px;
}

.login-actions {
  margin-top: 20px;
  font-size: 14px;
}

.login-actions a {
  color: white;
  text-decoration: none;
  margin: 0 10px;
}

.login-actions a:hover {
  text-decoration: underline;
}

.login-error {
  color: #ff4444;
  margin-bottom: 15px;
  display: none;
}

#idiot-container {
  position: relative;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

/* App Store Styles */
.app-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: transform 0.2s;
  cursor: pointer;
}

.app-card:hover {
  transform: translateY(-5px);
}

.app-card h3 {
  margin: 10px 0;
  color: #333;
}

.app-card p {
  color: #666;
  font-size: 14px;
  margin-bottom: 15px;
}

.install-btn {
  background: #CBC3E3;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
}

.install-btn:hover {
  background: #1557b0;
}

#app-search {
  font-size: 16px;
}

#app-search:focus {
  outline: none;
  border-color: #CBC3E3;
}

/* Game Styles */
.game-container {
  width: 100%;
  height: calc(100% - 32px);
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
}

.terminal-container {
  width: 100%;
  height: calc(100% - 32px);
  background: #000;
  padding: 10px;
  font-family: monospace;
  overflow-y: auto;
}

.terminal-output {
  color: #0F0;
  white-space: pre-wrap;
  margin-bottom: 10px;
}

.terminal-input-line {
  display: flex;
  color: #0F0;
}

.terminal-prompt {
  color: #0F0;
  margin-right: 8px;
}

.terminal-input {
  background: transparent;
  border: none;
  color: #0F0;
  font-family: monospace;
  flex: 1;
  outline: none;
}

.paint-toolbar {
  background: #f5f5f5;
  padding: 10px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

.paint-toolbar button {
  padding: 5px 10px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
}

.paint-toolbar button:hover {
  background: #eee;
}

.paint-toolbar input[type="color"] {
  width: 40px;
  height: 30px;
  padding: 0;
  border: 1px solid #ddd;
}

.paint-toolbar input[type="range"] {
  width: 100px;
}
.paint-toolbar .tool-label {
  margin-right: 5px;
  color: #666;
}

.paint-canvas-container {
  flex: 1;
  overflow: auto;
  background: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

#paint-canvas {
  background: #fff;
  border: 1px solid #ddd;
  cursor: crosshair;
}

.html-viewer {
  width: 100%;
  height: 100%;
  border: none;
  background: white;
}

.html-viewer-controls {
  display: flex;
  padding: 8px;
  background: #f5f5f5;
  border-bottom: 1px solid #ddd;
  gap: 10px;
}

.html-viewer-controls button {
  padding: 4px 8px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
}

.html-viewer-controls button:hover {
  background: #eee;
}

.files-container.dark-mode .html-source {
  background: #1e1e1e;
  color: #d4d4d4;
}

.files-container.dark-mode .html-viewer-controls {
  background: #2c2c2c;
  border-color: #444;
}

.files-container.dark-mode .html-viewer-controls button {
  background: #333;
  border-color: #444;
  color: #fff;
}

.files-container.dark-mode .html-viewer-controls button:hover {
  background: #444;
}
</style>
</head>
<body>
<div class="login-screen" id="loginScreen">
  <img src="Bonus/OS First Icon.png" class="chrome-logo">
  <div class="login-form">
    <h1>RhapmiumOS</h1>
    <div class="login-error" id="loginError">Invalid username or password</div>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Sign in</button>
    <div class="login-actions">
      <a href="#" onclick="showCreateAccount()">Create account</a>
      <a href="#" onclick="guestMode()">Browse as Guest</a>
    </div>
  </div>
</div>

<div class="desktop">
  <div id="appstore" class="app">
    <div class="title-bar">
      <div class="title">App Store</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;appstore&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;appstore&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;appstore&apos;)"></button>
      </div>
    </div>
    <div class="app-store-container" style="height: calc(100% - 32px); background: white; display: flex; flex-direction: column;">
      <p style="color: grey;">Rhapmium App Store</p>
      <div style="padding: 20px; background: #f5f5f5; border-bottom: 1px solid #ddd;">
        <input type="text" id="app-search" placeholder="Search apps..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div class="app-grid" style="padding: 20px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
        <!-- Games -->
        <div class="app-card" onclick="installApp(&apos;minecraft&apos;)">
          <img src="Assets/Minecraft.png" style="width: 64px; height: 64px;">
          <h3>Minecraft</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
<div class="app-card" onclick="installApp(&apos;chromehead&apos;)">
          <img src="Assets/Chromehead.png" style="width: 64px; height: 64px;">
          <h3>Chromehead</h3>
          <p>Communication</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;epiktube&apos;)">
          <img src="Assets/EpikTube.png" style="width: 64px; height: 64px;">
          <h3>EpikTube</h3>
          <p>Entertainment</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;maps&apos;)">
          <img src="Assets/Maps.png" style="width: 64px; height: 64px;">
          <h3>Maps</h3>
          <p>Travel</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;marker&apos;)">
          <img src="Assets/Markdown.png" style="width: 64px; height: 64px;">
          <h3>Markdown</h3>
          <p>Editors</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;mms&apos;)">
          <img src="Assets/Messaging.png" style="width: 64px; height: 64px;">
          <h3>Messaging</h3>
          <p>Communication</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;wstar&apos;)">
          <img src="Assets/WeatherStar.png" style="width: 64px; height: 64px;">
          <h3>WeatherStar</h3>
          <p>Weathers</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;msg&apos;)">
          <img src="Assets/MsgRoom.png" style="width: 64px; height: 64px;">
          <h3>MsgRoom</h3>
          <p>Chat</p>
          <button class="install-btn">Install</button> 
        </div>  
        <div class="app-card" onclick="installApp(&apos;sketchpad&apos;)">
          <img src="Assets/Sketchpad.png" style="width: 64px; height: 64px;">
          <h3>Sketchpad</h3>
          <p>Editors</p>
          <button class="install-btn">Install</button> 
        </div>   
        <div class="app-card" onclick="installApp(&apos;ruffleplayer&apos;)">
          <img src="Assets/Ruffle Player.png" style="width: 64px; height: 64px;">
          <h3>Ruffle Player</h3>
          <p>Entertainment</p>
          <button class="install-btn">Install</button> 
        </div>    
        <div class="app-card" onclick="installApp(&apos;halflife&apos;)">
          <img src="Assets/Half Life.png" style="width: 64px; height: 64px;">
          <h3>Half Life</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div> 
        <div class="app-card" onclick="installApp(&apos;doom&apos;)">
          <img src="Assets/Doom.png" style="width: 64px; height: 64px;">
          <h3>Doom</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;pinkynes&apos;)">
          <img src="Assets/PinkyNES.png" style="width: 64px; height: 64px;">
          <h3>PinkyNES</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>          
        <div class="app-card" onclick="installApp(&apos;quake&apos;)">
          <img src="Assets/Quake.png" style="width: 64px; height: 64px;">
          <h3>Quake</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>     
        <div class="app-card" onclick="installApp(&apos;pvz&apos;)">
          <img src="Assets/Plants vs. Zombies.png" style="width: 64px; height: 64px;">
          <h3>Plants vs. Zombies</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>     
        <div class="app-card" onclick="installApp(&apos;flappybird&apos;)">
          <img src="Assets/Flappy Bird.png" style="width: 64px; height: 64px;">
          <h3>Flappy Bird</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>   
        <div class="app-card" onclick="installApp(&apos;gamesnacks&apos;)">
          <img src="Assets/GameSnacks.png" style="width: 64px; height: 64px;">
          <h3>GameSnacks</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>   
        <div class="app-card" onclick="installApp(&apos;mine&apos;)">
          <img src="Assets/Minesweeper.png" style="width: 64px; height: 64px;">
          <h3>Minesweeper</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;pman&apos;)">
          <img src="Assets/PAC-MAN.png" style="width: 64px; height: 64px;">
          <h3>PAC-MAN</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;entanglement&apos;)">
          <img src="Assets/Entanglement.png" style="width: 64px; height: 64px;">
          <h3>Entanglement</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;poppit&apos;)">
          <img src="Assets/Poppit.png" style="width: 64px; height: 64px;">
          <h3>Poppit</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;drbeta&apos;)">
          <img src="Assets/DynaRoblox Beta.png" style="width: 64px; height: 64px;">
          <h3>DynaRoblox Beta</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;slideshow&apos;)">
          <img src="Assets/Slideshow.png" style="width: 64px; height: 64px;">
          <h3>Slideshow</h3>
          <p>Entertainment</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;ugmsearch&apos;)">
          <img src="Assets/Ungoogled Memphis!.png" style="width: 64px; height: 64px;">
          <h3>Ungoogled Memphis!</h3>
          <p>‎Utilities/Tools</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;fnaf&apos;)">
          <img src="Assets/Five Nights at Freddy's.png" style="width: 64px; height: 64px;">
          <h3>Five Nights at Freddy's</h3>
          <p>Games</p>
          <button class="install-btn">Install</button> 
        </div>
        <div class="app-card" onclick="installApp(&apos;fnaf2&apos;)">
          <img src="Assets/Five Nights at Freddy's 2.png" style="width: 64px; height: 64px;">
          <h3>Five Nights at Freddy's 2</h3>
          <p>‎Games</p>
          <button class="install-btn">Install</button>
        </div>
        <div class="app-card" onclick="installApp(&apos;djump&apos;)">
          <img src="Assets/Doodle Jump.png" style="width: 64px; height: 64px;">
          <h3>Doodle Jump</h3>
          <p>‎Games</p>
          <button class="install-btn">Install</button>
        </div>
      </div>
    </div>
  </div>

  <div id="files" class="app">
    <div class="title-bar">
      <div class="title">Files</div>
      <button class="export-btn" onclick="exportFiles()">Export Files
      </button>
      <button class="dark-mode-toggle" onclick="toggleDarkMode()">Dark Mode
      </button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;files&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;files&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;files&apos;)"></button>
      </div>
    </div>
    <div class="files-container">
      <div class="sidebar" id="sidebar">
        <!-- Sidebar content will be dynamically added -->
      </div>
      <div class="content" id="files-content">
        <!-- Files content will be dynamically added -->
      </div>
    </div>
  </div>

  <div id="browser" class="app">
    <div class="title-bar">
      <div class="title">Rhapmium</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;browser&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;browser&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;browser&apos;)"></button>
      </div>
    </div>
    <div class="browser-toolbar">
      <button class="nav-button" onclick="browserGoBack()">Back</button>
      <button class="nav-button" onclick="browserGoForward()">Forward</button>
      <button class="nav-button" onclick="browserRefresh()">Refresh</button>
      <input type="text" class="url-bar" id="urlBar" placeholder="Enter URL..." onkeydown="handleUrlKeydown(event)">
      <button class="nav-button" onclick="browserNavigate()">Go</button>
    </div>
    <div class="iframe-container">
      <iframe src="https://fooglesearch.neocities.org/" id="browserFrame"></iframe>
    </div>
  </div>

  <div id="settings" class="app" w-tid="265">
    <div class="title-bar" w-tid="267">
      <div class="title" w-tid="269">Settings</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest('.app').id)" w-tid="271"></button>
      <div class="controls" w-tid="273">
        <button class="control-button minimize" onclick="minimizeApp('settings')" w-tid="275"></button>
        <button class="control-button maximize" onclick="maximizeApp('settings')" w-tid="277"></button>
        <button class="control-button close" onclick="closeApp('settings')" w-tid="279"></button>
      </div>
    </div>
    <div class="settings-container" w-tid="281">
      <div class="settings-sidebar" w-tid="283">
        <div class="settings-section active" onclick="showSettingsSection('display')" w-tid="285">
          <img src="Assets/Settings.png" class="settings-icon" w-tid="287"/>
          Display & Performance
        </div>
        <div class="settings-section" onclick="showSettingsSection('appearance')" w-tid="289">
          <img src="Assets/Settings.png" class="settings-icon" w-tid="291"/>
          Appearance
        </div>
        <div class="settings-section" onclick="showSettingsSection('accessibility')" w-tid="293">
          <img src="Assets/Settings.png" class="settings-icon" w-tid="295"/>
          Accessibility
        </div>
        <div class="settings-section" onclick="showSettingsSection('privacy')" w-tid="297">
          <img src="Assets/Settings.png" class="settings-icon" w-tid="299"/>
          Privacy & Security
        </div>
        <div class="settings-section" onclick="showSettingsSection('about')" w-tid="301">
          <img src="Assets/Settings.png" class="settings-icon" w-tid="303"/>
          About
        </div>
      </div>
      <div class="settings-content" w-tid="305">
        <div id="display-section" class="settings-section-content" w-tid="307">
          <h2 w-tid="309">Display & Performance</h2>
          
          <div class="settings-item" w-tid="311">
            <div class="settings-item-label" w-tid="313">
              <div w-tid="315">Performance Mode</div>
              <div class="settings-description" w-tid="317">Limit FPS to 30 for authentic lag experience</div>
            </div>
            <label class="switch" w-tid="319">
              <input type="checkbox" id="fpsLimiter" onchange="toggleFPSLimit(this.checked)" w-tid="321"/>
              <span class="slider" w-tid="323"></span>
            </label>
          </div>

          <div class="settings-item" w-tid="325">
            <div class="settings-item-label" w-tid="327">
              <div w-tid="329">Resolution Scale</div>
              <div class="settings-description" w-tid="331">Lower resolution for more authenticity</div>
            </div>
            <select onchange="setResolutionScale(this.value)" class="settings-select" w-tid="333">
              <option value="1" w-tid="335">100%</option>
              <option value="0.75" w-tid="337">75%</option>
              <option value="0.5" w-tid="339">50%</option>
            </select>
          </div>
        </div>

        <div id="appearance-section" class="settings-section-content" style="display:none" w-tid="341">
          <h2 w-tid="343">Appearance</h2>
          
          <div class="settings-item" w-tid="345">
            <div class="settings-item-label" w-tid="347">
              <div w-tid="349">System Theme</div>
              <div class="settings-description" w-tid="351">Change the overall look of your system</div>
            </div>
            <select onchange="setSystemTheme(this.value)" class="settings-select" w-tid="353">
              <option value="light" w-tid="355">Light</option>
              <option value="dark" w-tid="357">Dark</option>
            </select>
          </div>

          <div class="settings-item" w-tid="359">
            <div class="settings-item-label" w-tid="361">
              <div w-tid="363">Taskbar Position</div>
              <div class="settings-description" w-tid="365">Change where the taskbar appears</div>
            </div>
            <select onchange="setTaskbarPosition(this.value)" class="settings-select" w-tid="367">
              <option value="bottom" w-tid="369">Bottom</option>
              <option value="top" w-tid="371">Top</option>
            </select>
          </div>

          <div class="settings-item" w-tid="373">
            <div class="settings-item-label" w-tid="375">
              <div w-tid="377">Desktop Wallpaper</div>
              <div class="settings-description" w-tid="379">Choose your desktop background</div>
            </div>
            <button onclick="changeWallpaper()" class="settings-button" w-tid="381">Change Wallpaper</button>
          </div>
        </div>

        <div id="accessibility-section" class="settings-section-content" style="display:none" w-tid="383">
          <h2 w-tid="385">Accessibility</h2>
          
          <div class="settings-item" w-tid="387">
            <div class="settings-item-label" w-tid="389">
              <div w-tid="391">High Contrast Mode</div>
              <div class="settings-description" w-tid="393">Increase contrast for better visibility</div>
            </div>
            <label class="switch" w-tid="395">
              <input type="checkbox" onchange="toggleHighContrast(this.checked)" w-tid="397"/>
              <span class="slider" w-tid="399"></span>
            </label>
          </div>

          <div class="settings-item" w-tid="401">
            <div class="settings-item-label" w-tid="403">
              <div w-tid="405">Large Text</div>
              <div class="settings-description" w-tid="407">Increase text size throughout the system</div>
            </div>
            <label class="switch" w-tid="409">
              <input type="checkbox" onchange="toggleLargeText(this.checked)" w-tid="411"/>
              <span class="slider" w-tid="413"></span>
            </label>
          </div>
        </div>

        <div id="privacy-section" class="settings-section-content" style="display:none" w-tid="415">
          <h2 w-tid="417">Privacy & Security</h2>
          
          <div class="settings-item" w-tid="419">
            <div class="settings-item-label" w-tid="421">
              <div w-tid="423">Clear Browser Data</div>
              <div class="settings-description" w-tid="425">Clear all browser history and cache</div>
            </div>
            <button onclick="clearBrowserData()" class="settings-button" w-tid="427">Clear Data</button>
          </div>

          <div class="settings-item" w-tid="429">
            <div class="settings-item-label" w-tid="431">
              <div w-tid="433">Safe Browsing</div>
              <div class="settings-description" w-tid="435">Protect against dangerous sites</div>
            </div>
            <label class="switch" w-tid="437">
              <input type="checkbox" checked onchange="toggleSafeBrowsing(this.checked)" w-tid="439"/>
              <span class="slider" w-tid="441"></span>
            </label>
          </div>
        </div>

        <div id="about-section" class="settings-section-content" style="display:none" w-tid="443">
          <h2 w-tid="445">About</h2>
          
          <div class="settings-item" w-tid="447">
            <div class="settings-item-label" w-tid="449">
            <img src="Bonus/OS First Icon.png" width="50" height="50">
              <div w-tid="451">System Version</div>
              <div class="settings-description" w-tid="453">RhapmiumOS 1.0.0</div>
            </div>
 <a href="https://github.com/thenerdguying/RhapmiumOS"><img src="Bonus/GitHub.png" style="width:100px;height:40px;"></a>
 <a href="https://discord.gg/WSeW8Hca"><img src="Bonus/Discord.png" style="width:50px;height:50px;"></a>
          </div>

          <div class="settings-item" w-tid="455">
            <div class="settings-item-label" w-tid="457">
              <div w-tid="459">Build Number</div>
              <img src="Bonus/OS First Logo.png" width="200" height="200">
              <div class="settings-description" w-tid="461">2025.1.0</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="cale" class="app">
    <div class="title-bar">
      <div class="title">Calendar</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;cale&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;cale&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;cale&apos;)"></button>
      </div>
    </div>
    <iframe src="https://thenerdguying.github.io/Calendar/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

  <div id="calc" class="app">
    <div class="title-bar">
      <div class="title">Calculator</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;calc&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;calc&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;calc&apos;)"></button>
      </div>
    </div>
    <iframe src="https://thenerdguying.github.io/Calculator/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

  <div id="snakemods" class="app">
    <div class="title-bar">
      <div class="title">Snake Mods</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;snakemods&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;snakemods&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;snakemods&apos;)"></button>
      </div>
    </div>
    <iframe src="https://googlesnakemods.com/v/current/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

  <div id="terminal" class="app">
    <div class="title-bar">
      <div class="title">Terminal</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;terminal&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;terminal&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;terminal&apos;)"></button>
      </div>
    </div>
    <div class="terminal-container">
      <div id="terminal-output"></div>
      <div class="terminal-input-line">
        <span class="terminal-prompt">guest@rhapmiumos:~&#x24;</span>
        <input type="text" class="terminal-input" id="terminal-input" onkeydown="handleTerminalInput(event)">
      </div>
    </div>
  </div>

  <div id="camera" class="app">
    <div class="title-bar">
      <div class="title">Camera</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;camera&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;camera&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;camera&apos;)"></button>
      </div>
    </div>
    <iframe src="https://thenerdguying.github.io/Camera/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

  <div id="picsnap" class="app">
    <div class="title-bar">
      <div class="title">PicSnap</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;picsnap&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;picsnap&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;picsnap&apos;)"></button>
      </div>
    </div>
    <div style="height: calc(100% - 32px); display: flex; flex-direction: column;">
      <div class="paint-toolbar">
        <button onclick="setPaintTool(&apos;brush&apos;)">Brush</button>
        <button onclick="setPaintTool(&apos;eraser&apos;)">Eraser</button>
        <button onclick="clearCanvas()">Clear</button>
        <div>
          <span class="tool-label">Color:</span>
          <input type="color" id="paint-color" onchange="updatePaintColor(this.value)">
        </div>
        <div>
          <span class="tool-label">Size:</span>
          <input type="range" id="paint-size" min="1" max="50" value="5" onchange="updateBrushSize(this.value)">
        </div>
        <button onclick="savePainting()">Save</button>
      </div>
      <div class="paint-canvas-container">
        <canvas id="paint-canvas" width="800" height="600"></canvas>
      </div>
    </div>
  </div>

  <div id="gallery" class="app">
    <div class="title-bar">
      <div class="title">Gallery</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;gallery&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;gallery&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;gallery&apos;)"></button>
      </div>
    </div>
    <div class="gallery-container" style="width:100%; height:calc(100% - 32px); display:flex; align-items:center; justify-content:center; background:#000;">
      <div id="gallery-content" style="max-width:100%; max-height:100%;"></div>
    </div>
  </div>

  <div id="alarm" class="app">
    <div class="title-bar">
      <div class="title">Clock</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;alarm&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;alarm&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;alarm&apos;)"></button>
      </div>
    </div>
    <iframe src="https://thenerdguying.github.io/Clock/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

 <div id="music" class="app">
    <div class="title-bar">
      <div class="title">Music Player</div>
      <button class="control-button fullscreen-btn" onclick="toggleFullscreen(this.closest(&apos;.app&apos;).id)"></button>
      <div class="controls">
        <button class="control-button minimize" onclick="minimizeApp(&apos;music&apos;)"></button>
        <button class="control-button maximize" onclick="maximizeApp(&apos;music&apos;)"></button>
        <button class="control-button close" onclick="closeApp(&apos;music&apos;)"></button>
      </div>
    </div>
    <iframe src="https://thenerdguying.github.io/Music-Player/" style="width:100%;height:calc(100% - 32px);border:none;"></iframe>
  </div>

<div class="taskbar">
  <button class="launcher-btn" onclick="toggleLauncher()">
    <img src="Assets/Drawer.png" width="20" height="20">
    Apps
  </button>
  <button class="import-btn" onclick="importFiles()">
    <img src="Assets/Folder.png" width="20" height="20">
    Import Files
  </button>
  <div class="launcher-menu" id="launcher">
    <div class="launcher-item" onclick="toggleApp(&apos;appstore&apos;)">
      <img src="Assets/App Store.png" class="launcher-icon">
      App Store
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;files&apos;)">
      <img src="Assets/Files.png" class="launcher-icon">
      Files
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;browser&apos;)">
      <img src="Assets/Rhapmium.png" class="launcher-icon">
      Rhapmium
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;settings&apos;)">
      <img src="Assets/Settings.png" class="launcher-icon">
      Settings
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;cale&apos;)">
      <img src="Assets/Calendar.png" class="launcher-icon">
      Calendar
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;calc&apos;)">
      <img src="Assets/Calculator.png" class="launcher-icon">
      Calculator
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;snakemods&apos;)">
      <img src="Assets/Snake Mods.png" class="launcher-icon">
      Snake Mods
    </div>
    <div class="launcher-item" onclick="changeWallpaper()">
      <img src="Assets/Change Wallpaper.png" class="launcher-icon">
      Change Wallpaper
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;terminal&apos;)">
      <img src="Assets/Terminal.png" class="launcher-icon">
      Terminal
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;camera&apos;)">
      <img src="Assets/Camera.png" class="launcher-icon">
      Camera
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;picsnap&apos;)">
      <img src="Assets/PicSnap.png" class="launcher-icon">
      PicSnap
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;gallery&apos;)">
      <img src="Assets/Gallery.png" class="launcher-icon">
      Gallery
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;alarm&apos;)">
      <img src="Assets/Clock.png" class="launcher-icon">
      Clock
    </div>
    <div class="launcher-item" onclick="toggleApp(&apos;music&apos;)">
      <img src="Assets/Music Player.png" class="launcher-icon">
      Music Player
    </div>
  </div>
  <div class="save-load">
   <button onclick="saveState()">Save State</button>
   <button onclick="loadState()">Load State</button>
  </div>
   <div class="clock" id="clock"></div>
</div>

<script>let virusWindowCount = 0;
let fileSystem = {
  'Documents': [],
  'Downloads': [],
  'Pictures': [],
  'Music': []
};
const SUPPORTED_FILE_TYPES = {
  media: ['.mp4', '.webm', '.ogg', '.mp3', '.wav', '.m4a', '.aac', '.flac', '.3gp', '.mov', '.m4v', '.mkv', '.ogm', '.oga'],
  images: ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.ico', '.svg', '.tiff'],
  compressed: ['.zip', '.rar', '.7z', '.tar', '.gz'],
  documents: ['.txt', '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.csv', '.rtf', '.html', '.htm', '.md']
};
let currentFolder = 'Documents';
let sidebarSelected = 'Documents';
let isDarkMode = false;
let fpsInterval;
let users = JSON.parse(localStorage.getItem('chromeUsers') || '{}');
let currentUser = null;
let commandHistory = [];
let historyIndex = -1;
let currentDirectory = '~';
let paintCtx;
let isPainting = false;
let currentTool = 'brush';
let brushSize = 5;
let paintColor = '#000000';
let fullscreenApps = new Set();
function getWindowBounds() {
  return {
    width: window.innerWidth,
    height: window.innerHeight - document.querySelector('.taskbar').offsetHeight
  };
}
window.onload = function () {
  const loginScreen = document.getElementById('loginScreen');
  loginScreen.style.display = 'flex';
  document.querySelector('.desktop').style.display = 'none';
  document.querySelector('.taskbar').style.display = 'none';
};
function getFileIcon(extension) {
  if (SUPPORTED_FILE_TYPES.media.includes(extension)) {
    return 'Assets/Files/music.png';
  } else if (SUPPORTED_FILE_TYPES.images.includes(extension)) {
    return 'Assets/Files/image.png';
  } else if (SUPPORTED_FILE_TYPES.compressed.includes(extension)) {
    return 'Assets/Files/zip.png';
  } else if (extension === '.pdf') {
    return 'Assets/Files/pdf.png';
  } else if (extension === '.html') {
    return 'Assets/Files/html.png';
  }
  return 'Assets/Files/description.png';
}
function formatFileSize(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}
function updateClock() {
  const clock = document.getElementById('clock');
  const now = new Date();
  clock.textContent = now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();
document.addEventListener('click', e => {
  const launcher = document.getElementById('launcher');
  const launcherBtn = document.querySelector('.launcher-btn');
  if (!launcher.contains(e.target) && !launcherBtn.contains(e.target)) {
    launcher.style.display = 'none';
  }
});
function toggleApp(id) {
  const app = document.getElementById(id);
  if (app.style.display === 'none' || !app.style.display) {
    app.style.display = 'block';
    if (id === 'files') {
      initializeFilesApp();
    }
    if (id === 'browser') {
      const frame = document.getElementById('browserFrame');
      const urlBar = document.getElementById('urlBar');
      urlBar.value = frame.src;
    }
    if (id === 'paint') {
      setTimeout(initPaint, 100);
    }
  } else {
    app.style.display = 'none';
  }
}
function closeApp(id) {if (id === 'snake')
{
  } else if (id === 'virus' && document.getElementById('idiot-container').style.display === 'block') {
    for (let i = 0; i < 3; i++) {
      createIdiotWindow();
    }
    return;
  }
  document.getElementById(id).style.display = 'none';
}
function minimizeApp(id) {
  const app = document.getElementById(id);
  app.style.transform = 'translate(0, 100vh)';
  app.style.display = 'none';
}
function maximizeApp(id) {
  const app = document.getElementById(id);
  const taskbar = document.querySelector('.taskbar');
  const isMaximized = app.dataset.maximized === 'true';
  if (fullscreenApps.has(id)) {
    toggleFullscreen(id);
  }
  if (!isMaximized) {
    const style = window.getComputedStyle(app);
    const matrix = new DOMMatrix(style.transform);
    app.dataset.prevTransform = app.style.transform;
    app.style.transform = 'translate(0, 0)';
    app.style.width = '100%';
    app.style.height = `calc(100% - ${taskbar.offsetHeight}px)`;
    app.style.borderRadius = '0';
    taskbar.style.display = 'none';
    app.dataset.maximized = 'true';
    const maximizeBtn = app.querySelector('.maximize');
    maximizeBtn.onclick = () => restoreApp(id);
  }
}
function restoreApp(id) {
  const app = document.getElementById(id);
  const taskbar = document.querySelector('.taskbar');
  if (fullscreenApps.has(id)) {
    toggleFullscreen(id);
  }
  app.style.transform = app.dataset.prevTransform || 'translate(-50%, -50%)';
  app.style.width = '800px';
  app.style.height = '600px';
  app.style.borderRadius = '8px';
  taskbar.style.display = 'flex';
  app.dataset.maximized = 'false';
  const maximizeBtn = app.querySelector('.maximize');
  maximizeBtn.onclick = () => maximizeApp(id);
}
document.querySelectorAll('.title-bar').forEach(titleBar => {
  let pos1 = 0,
    pos2 = 0,
    pos3 = 0,
    pos4 = 0;
  let isDragging = false;
  const app = titleBar.parentElement;
  titleBar.onmousedown = dragMouseDown;
  function dragMouseDown(e) {
    if (e.target.classList.contains('control-button')) return;
    e = e || window.event;
    e.preventDefault();
    pos3 = e.clientX;
    pos4 = e.clientY;
    isDragging = true;
    document.onmouseup = closeDragElement;
    document.onmousemove = elementDrag;
  }
  function elementDrag(e) {
    if (!isDragging) return;
    e = e || window.event;
    e.preventDefault();
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    let style = window.getComputedStyle(app);
    let matrix = new DOMMatrix(style.transform);
    let currentX = matrix.m41;
    let currentY = matrix.m42;
    app.style.transform = `translate(${currentX - pos1}px, ${currentY - pos2}px)`;
  }
  function closeDragElement() {
    isDragging = false;
    document.onmouseup = null;
    document.onmousemove = null;
  }
});
function initializeFilesApp() {
  const titleBar = document.querySelector('#files .title-bar');
  renderSidebar();
  renderFiles();
}
function importFiles() {
  const input = document.createElement('input');
  input.type = 'file';
  input.multiple = true;
  input.accept = Object.values(SUPPORTED_FILE_TYPES).flat().join(',') + ',.json';
  input.onchange = async e => {
    const files = Array.from(e.target.files);
    for (const file of files) {
      if (file.name.endsWith('.json')) {
        const reader = new FileReader();
        reader.onload = event => {
          try {
            const importedData = JSON.parse(event.target.result);
            if (importedData.fileSystem) {
              Object.keys(importedData.fileSystem).forEach(folder => {
                if (!fileSystem[folder]) {
                  fileSystem[folder] = [];
                }
                fileSystem[folder].push(...importedData.fileSystem[folder]);
              });
              renderFiles();
              saveState();
            }
          } catch (error) {
            console.error('Error importing file system:', error);
          }
        };
        reader.readAsText(file);
        continue;
      }
      const extension = '.' + file.name.split('.').pop().toLowerCase();
      const fileObj = {
        id: generateRandomId(),
        name: file.name,
        type: file.type,
        size: file.size,
        extension: extension,
        lastModified: new Date(file.lastModified)
      };
      try {
        if (SUPPORTED_FILE_TYPES.images.includes(extension) || SUPPORTED_FILE_TYPES.media.includes(extension)) {
          fileObj.content = file;
          if (SUPPORTED_FILE_TYPES.images.includes(extension)) {
            fileSystem.Pictures.unshift(fileObj);
          } else {
            fileSystem.Music.unshift(fileObj);
          }
        } else if (['.txt', '.md', '.csv', '.rtf'].includes(extension)) {
          fileObj.content = await file.text();
          fileSystem.Documents.unshift(fileObj);
        } else if (extension === '.pdf' || extension === '.html' || extension === '.htm') {
          fileObj.content = file;
          fileSystem.Documents.unshift(fileObj);
        } else if (['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'].includes(extension)) {
          fileObj.content = file;
          fileSystem.Documents.unshift(fileObj);
        } else if (SUPPORTED_FILE_TYPES.compressed.includes(extension)) {
          fileObj.content = file;
          fileSystem.Downloads.unshift(fileObj);
        } else {
          fileObj.content = file;
          fileSystem.Downloads.unshift(fileObj);
        }
      } catch (error) {
        console.error(`Error importing file ${file.name}:`, error);
      }
    }
    renderFiles();
    saveState();
  };
  input.click();
}
function loadNewPage(url) {
  location.href = url;
}

// Example usage:
// loadNewPage('/');    
function renderSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.innerHTML = Object.keys(fileSystem).map(folder => `
    <div class="sidebar-item ${folder === sidebarSelected ? 'selected' : ''}" 
         onclick="selectFolder('${folder}')">
      ${folder}
    </div>
  `).join('');
}
function selectFolder(folder) {
  currentFolder = folder;
  sidebarSelected = folder;
  renderSidebar();
  renderFiles();
}
function renderFiles() {
  const content = document.getElementById('files-content');
  if (!fileSystem[currentFolder] || fileSystem[currentFolder].length === 0) {
    content.innerHTML = `
      <div style="text-align: center; padding: 20px; color: ${isDarkMode ? '#fff' : '#666'}">
        <h3>No files in this folder</h3>
        <p>Click the Import button to add files</p>
      </div>
    `;
    return;
  }
  content.innerHTML = `
    <div class="files-grid">
      ${fileSystem[currentFolder].map(file => {
    const extension = '.' + file.name.split('.').pop().toLowerCase();
    const size = formatFileSize(file.size);
    const date = new Date(file.lastModified).toLocaleDateString();
    return `
          <div class="file-item" onclick="openFile('${file.id}')" title="${file.name}&#13;Size: ${size}&#13;Modified: ${date}">
            <img src="${getFileIcon(extension)}?color=${isDarkMode ? 'white' : 'black'}" class="file-icon">
            <div class="file-name">${file.name}</div>
            <div class="file-meta" style="font-size: 10px; color: ${isDarkMode ? '#aaa' : '#666'}">
              ${size} • ${date}
            </div>
          </div>
        `;
  }).join('')}
    </div>
  `;
}
function openFile(fileId) {
  const file = fileSystem[currentFolder].find(f => f.id === fileId);
  if (!file) return;
  const extension = '.' + file.name.split('.').pop().toLowerCase();
  if (SUPPORTED_FILE_TYPES.images.includes(extension) || SUPPORTED_FILE_TYPES.media.includes(extension)) {
    const gallery = document.getElementById('gallery');
    const content = document.getElementById('gallery-content');
    if (SUPPORTED_FILE_TYPES.images.includes(extension)) {
      content.innerHTML = `<img src="${URL.createObjectURL(file.content)}" style="max-width:100%; max-height:100%; object-fit:contain;">`;
    } else if (SUPPORTED_FILE_TYPES.media.includes(extension)) {
      if (extension === '.mp3' || extension === '.wav' || extension === '.ogg' || extension === '.m4a' || extension === '.aac' || extension === '.flac') {
        content.innerHTML = `
          <audio controls style="width:100%; max-width:500px;">
            <source src="${URL.createObjectURL(file.content)}" type="${file.type}">
          </audio>`;
      } else {
        content.innerHTML = `
          <video controls style="max-width:100%; max-height:100%; object-fit:contain;">
            <source src="${URL.createObjectURL(file.content)}" type="${file.type}">
          </video>`;
      }
    }
    gallery.style.display = 'block';
    return;
  }
  const viewer = document.createElement('div');
  viewer.className = 'file-viewer';
  let content = '';
  if (extension === '.pdf') {
    content = `<embed src="${URL.createObjectURL(file.content)}" type="application/pdf" width="100%" height="100%">`;
  } else if (['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'].includes(extension)) {
    content = `
      <iframe 
        src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(URL.createObjectURL(file.content))}" 
        width="100%" 
        height="100%" 
        frameborder="0">
      </iframe>`;
  } else if (extension === '.txt' || extension === '.md' || extension === '.csv' || extension === '.rtf') {
    content = `<pre style="white-space:pre-wrap;font-family:monospace;padding:20px;background:${isDarkMode ? '#222' : '#fff'};color:${isDarkMode ? '#fff' : '#000'};overflow:auto;height:100%;">${file.content}</pre>`;
  } else if (extension === '.html' || extension === '.htm') {
    viewer.innerHTML = `
      <div class="viewer-overlay">
        <div class="viewer-content">
          <div class="html-viewer-controls">
            <button onclick="reloadHtmlPreview(this)">Reload</button>
            <button onclick="toggleHtmlSource(this)">View Source</button>
            <button onclick="closeViewer(this)">Close</button>
          </div>
          <iframe class="html-viewer" src="${URL.createObjectURL(file.content)}"></iframe>
          <pre class="html-source" style="display:none; margin:0; padding:20px; height:100%; overflow:auto;"></pre>
        </div>
      </div>
    `;
    const reader = new FileReader();
    reader.onload = e => {
      viewer.querySelector('.html-source').textContent = e.target.result;
    };
    reader.readAsText(file.content);
    document.body.appendChild(viewer);
    return;
  } else if (SUPPORTED_FILE_TYPES.compressed.includes(extension)) {
    content = `
      <div style="padding:20px;background:${isDarkMode ? '#222' : '#fff'};color:${isDarkMode ? '#fff' : '#000'}">
        <h3>${file.name}</h3>
        <p>Archive file</p>
        <p>File size: ${formatFileSize(file.size)}</p>
        <p>Last modified: ${new Date(file.lastModified).toLocaleString()}</p>
      </div>`;
  } else {
    content = `
      <div style="padding:20px;background:${isDarkMode ? '#222' : '#fff'};color:${isDarkMode ? '#fff' : '#000'}">
        <h3>${file.name}</h3>
        <p>File size: ${formatFileSize(file.size)}</p>
        <p>Last modified: ${new Date(file.lastModified).toLocaleString()}</p>
      </div>`;
  }
  viewer.innerHTML = `
    <div class="viewer-overlay">
      <div class="viewer-content">
        ${content}
        <button onclick="closeViewer(this)">Close</button>
      </div>
    </div>
  `;
  document.body.appendChild(viewer);
}
function closeViewer(button) {
  const viewer = button.closest('.file-viewer');
  if (viewer) {
    viewer.remove();
  }
}
function generateRandomId() {
  return 'save_' + Math.random().toString(36).substr(2, 9);
}
function saveState() {
  const state = {
    fileSystem,
    currentFolder,
    sidebarSelected,
    isDarkMode,
    gdriveFiles: fileSystem.Downloads.filter(f => f.fromGDrive)
  };
  const blob = new Blob([JSON.stringify(state)], {
    type: 'application/json'
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = generateRandomId() + '.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
function loadState() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = event => {
      const state = JSON.parse(event.target.result);
      fileSystem = state.fileSystem;
      currentFolder = state.currentFolder;
      sidebarSelected = state.sidebarSelected;
      isDarkMode = state.isDarkMode;
      if (state.gdriveFiles) {
        state.gdriveFiles.forEach(file => {
          if (!fileSystem.Downloads.find(f => f.id === file.id)) {
            fileSystem.Downloads.push(file);
          }
        });
      }
      const filesContainer = document.querySelector('.files-container');
      const darkModeBtn = document.querySelector('.dark-mode-toggle');
      if (isDarkMode) {
        filesContainer.classList.add('dark-mode');
        darkModeBtn.innerHTML = `
          <img src="https://api.iconify.design/material-symbols:light-mode.svg?color=white" width="16" height="16">
          Light Mode
        `;
      } else {
        filesContainer.classList.remove('dark-mode');
        darkModeBtn.innerHTML = `
          <img src="https://api.iconify.design/material-symbols:dark-mode.svg?color=white" width="16" height="16">
          Dark Mode
        `;
      }
      initializeFilesApp();
    };
    reader.readAsText(file);
  };
  input.click();
}
function toggleDarkMode() {
  isDarkMode = !isDarkMode;
  const filesContainer = document.querySelector('.files-container');
  const darkModeBtn = document.querySelector('.dark-mode-toggle');
  if (isDarkMode) {
    filesContainer.classList.add('dark-mode');
    darkModeBtn.innerHTML = `
      <img src="https://api.iconify.design/material-symbols:light-mode.svg?color=white" width="16" height="16">
      Light Mode
    `;
  } else {
    filesContainer.classList.remove('dark-mode');
    darkModeBtn.innerHTML = `
      <img src="https://api.iconify.design/material-symbols:dark-mode.svg?color=white" width="16" height="16">
      Dark Mode
    `;
  }
}
function changeWallpaper() {
  const wallpapers = ['Wallpapers/Nocturne.jpg', 'Wallpapers/Guest.jpg', 'Wallpapers/Default.jpg', 'Wallpapers/Child.jpg', 'Wallpapers/Wallpaper.jpg', 'none'];
  const desktop = document.querySelector('.desktop');
  const currentBg = desktop.style.backgroundImage;
  let nextIndex = 0;
  if (currentBg) {
    const currentUrl = currentBg.match(/url\(['"]?(.*?)['"]?\)/)?.[1] || 'none';
    nextIndex = (wallpapers.indexOf(currentUrl) + 1) % wallpapers.length;
  }
  if (wallpapers[nextIndex] === 'none') {
    desktop.style.backgroundImage = 'none';
    desktop.style.backgroundColor = '#000000';
  } else {
    desktop.style.backgroundImage = `url('${wallpapers[nextIndex]}')`;
    desktop.style.backgroundColor = 'initial';
  }
}
function browserGoBack() {
  const frame = document.getElementById('browserFrame');
  try {
    frame.contentWindow.history.back();
  } catch (e) {
    console.log('Cannot access frame history');
  }
}
function browserGoForward() {
  const frame = document.getElementById('browserFrame');
  try {
    frame.contentWindow.history.forward();
  } catch (e) {
    console.log('Cannot access frame history');
  }
}
function browserRefresh() {
  const frame = document.getElementById('browserFrame');
  frame.src = frame.src;
}
function browserNavigate() {
  const urlBar = document.getElementById('urlBar');
  const frame = document.getElementById('browserFrame');
  let url = urlBar.value.trim();
  if (!url.startsWith('http://') && !url.startsWith('https://')) {
    url = 'https://' + url;
  }
  frame.src = url;
}
function handleUrlKeydown(event) {
  if (event.key === 'Enter') {
    browserNavigate();
  }
}
function showSettingsSection(section) {
  document.querySelectorAll('.settings-section-content').forEach(el => {
    el.style.display = 'none';
  });
  document.getElementById(`${section}-section`).style.display = 'block';
  document.querySelectorAll('.settings-section').forEach(el => {
    el.classList.remove('active');
  });
  document.querySelector(`.settings-section[onclick*="${section}"]`).classList.add('active');
}
function toggleFPSLimit(enabled) {
  if (enabled) {
    fpsInterval = setInterval(() => {
      document.body.style.opacity = '0.99';
      setTimeout(() => {
        document.body.style.opacity = '1';
      }, 16);
    }, 33);
  } else {
    clearInterval(fpsInterval);
  }
}
function setResolutionScale(scale) {
  document.body.style.transform = `scale(${scale})`;
  document.body.style.transformOrigin = 'center top';
}
function setSystemTheme(theme) {
  if (theme === 'dark') {
    document.body.style.background = '#333';
    document.querySelector('.taskbar').style.background = '#222';
  } else {
    document.body.style.background = '#fff';
    document.querySelector('.taskbar').style.background = '#f0f0f0';
  }
}
function setTaskbarPosition(position) {
  const taskbar = document.querySelector('.taskbar');
  const desktop = document.querySelector('.desktop');
  if (position === 'top') {
    taskbar.style.top = '0';
    taskbar.style.bottom = 'auto';
    desktop.style.marginTop = '40px';
    desktop.style.marginBottom = '0';
  } else {
    taskbar.style.bottom = '0';
    taskbar.style.top = 'auto';
    desktop.style.marginTop = '0';
    desktop.style.marginBottom = '40px';
  }
}
function toggleHighContrast(enabled) {
  if (enabled) {
    document.body.style.filter = 'contrast(150%)';
  } else {
    document.body.style.filter = 'none';
  }
}
function toggleLargeText(enabled) {
  document.body.style.fontSize = enabled ? '120%' : '100%';
}
function clearBrowserData() {
  const frame = document.getElementById('browserFrame');
  frame.src = frame.src;
  alert('Browser data cleared!');
}
function toggleSafeBrowsing(enabled) {
  console.log('Safe browsing:', enabled);
}
function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  if (users[username] && users[username].password === password) {
    currentUser = username;
    document.getElementById('loginScreen').style.display = 'none';
    document.querySelector('.desktop').style.display = 'block';
    document.querySelector('.taskbar').style.display = 'flex';
    document.getElementById('loginError').style.display = 'none';
  } else {
    document.getElementById('loginError').style.display = 'block';
  }
}
function showCreateAccount() {
  const loginForm = document.querySelector('.login-form');
  loginForm.innerHTML = `
    <h1>Create Account</h1>
    <div class="login-error" id="createError"></div>
    <input type="text" id="newUsername" placeholder="Choose Username" required>
    <input type="password" id="newPassword" placeholder="Choose Password" required>
    <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
    <button onclick="createAccount()">Create Account</button>
    <div class="login-actions">
      <a href="#" onclick="showLogin()">Back to login</a>
    </div>
  `;
}
function showLogin() {
  const loginForm = document.querySelector('.login-form');
  loginForm.innerHTML = `
    <h1>RhapmiumOS</h1>
    <div class="login-error" id="loginError">Invalid username or password</div>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Sign in</button>
    <div class="login-actions">
      <a href="#" onclick="showCreateAccount()">Create account</a>
      <a href="#" onclick="guestMode()">Browse as Guest</a>
    </div>
  `;
}
function createAccount() {
  const username = document.getElementById('newUsername').value;
  const password = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const createError = document.getElementById('createError');
  if (!username || !password) {
    createError.textContent = 'Please fill in all fields';
    createError.style.display = 'block';
    return;
  }
  if (password !== confirmPassword) {
    createError.textContent = 'Passwords do not match';
    createError.style.display = 'block';
    return;
  }
  if (users[username]) {
    createError.textContent = 'Username already exists';
    createError.style.display = 'block';
    return;
  }
  users[username] = {
    password: password,
    created: new Date().toISOString()
  };
  localStorage.setItem('chromeUsers', JSON.stringify(users));
  currentUser = username;
  document.getElementById('loginScreen').style.display = 'none';
  document.querySelector('.desktop').style.display = 'block';
  document.querySelector('.taskbar').style.display = 'flex';
}
function guestMode() {
  currentUser = 'guest';
  document.querySelector('.terminal-prompt').textContent = `${currentUser}@rhapmiumos:~$`;
  document.getElementById('loginScreen').style.display = 'none';
  document.querySelector('.desktop').style.display = 'block';
  document.querySelector('.taskbar').style.display = 'flex';
  document.getElementById('loginError').style.display = 'none';
}
function toggleLauncher() {
  const launcher = document.getElementById('launcher');
  if (launcher.style.display === 'none' || !launcher.style.display) {
    launcher.style.display = 'block';
  } else {
    launcher.style.display = 'none';
  }
}
let snake, food, snakeDirection, snakeScore;
let snakeGame;
function initSnake() {
  const canvas = document.getElementById('snake-canvas');
  const ctx = canvas.getContext('2d');
  const gridSize = 20;
  snake = [{
    x: 10,
    y: 10
  }, {
    x: 9,
    y: 10
  }, {
    x: 8,
    y: 10
  }];
  food = {
    x: Math.floor(Math.random() * (canvas.width / gridSize)),
    y: Math.floor(Math.random() * (canvas.height / gridSize))
  };
  snakeDirection = 'right';
  snakeScore = 0;
  document.addEventListener('keydown', handleSnakeInput);
  function handleSnakeInput(e) {
    if (e.key === 'ArrowUp' && snakeDirection !== 'down') snakeDirection = 'up';
    if (e.key === 'ArrowDown' && snakeDirection !== 'up') snakeDirection = 'down';
    if (e.key === 'ArrowLeft' && snakeDirection !== 'right') snakeDirection = 'left';
    if (e.key === 'ArrowRight' && snakeDirection !== 'left') snakeDirection = 'right';
  }
  function updateSnake() {
    const head = {
      x: snake[0].x,
      y: snake[0].y
    };
    switch (snakeDirection) {
      case 'up':
        head.y--;
        break;
      case 'down':
        head.y++;
        break;
      case 'left':
        head.x--;
        break;
      case 'right':
        head.x++;
        break;
    }
    if (head.x === food.x && head.y === food.y) {
      food.x = Math.floor(Math.random() * (canvas.width / gridSize));
      food.y = Math.floor(Math.random() * (canvas.height / gridSize));
      snakeScore += 10;
      document.getElementById('snake-score').textContent = snakeScore;
    } else {
      snake.pop();
    }
    if (head.x < 0 || head.x >= canvas.width / gridSize || head.y < 0 || head.y >= canvas.height / gridSize || snake.some(segment => segment.x === head.x && segment.y === head.y)) {
      clearInterval(snakeGame);
      alert(`Game Over! Score: ${snakeScore}`);
      return;
    }
    snake.unshift(head);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'red';
    ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
    ctx.fillStyle = 'lime';
    snake.forEach(segment => {
      ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);
    });
  }
  snakeGame = setInterval(updateSnake, 100);
}
let ball, paddle1, paddle2, pongScore;
let pongGame;
function initPong() {
  const canvas = document.getElementById('pong-canvas');
  const ctx = canvas.getContext('2d');
  ball = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    dx: 4,
    dy: 4,
    radius: 8
  };
  paddle1 = {
    x: 0,
    y: canvas.height / 2 - 40,
    width: 10,
    height: 80,
    dy: 8,
    isAI: false
  };
  paddle2 = {
    x: canvas.width - 10,
    y: canvas.height / 2 - 40,
    width: 10,
    height: 80,
    dy: 8,
    isAI: true
  };
  pongScore = {
    player1: 0,
    player2: 0
  };
  document.addEventListener('keydown', handlePongInput);
  function handlePongInput(e) {
    if (e.key === 'w' && paddle1.y > 0) paddle1.y -= paddle1.dy;
    if (e.key === 's' && paddle1.y < canvas.height - paddle1.height) paddle1.y += paddle1.dy;
  }
  function updateAI() {
    const targetY = ball.y - paddle2.height / 2;
    const currentCenter = paddle2.y + paddle2.height / 2;
    const diff = targetY - currentCenter;
    if (Math.abs(diff) > paddle2.height / 4) {
      const speed = paddle2.dy * (0.85 + Math.random() * 0.3);
      paddle2.y += diff > 0 ? speed : -speed;
    }
    if (paddle2.y < 0) paddle2.y = 0;
    if (paddle2.y > canvas.height - paddle2.height) {
      paddle2.y = canvas.height - paddle2.height;
    }
  }
  function updatePong() {
    ball.x += ball.dx;
    ball.y += ball.dy;
    updateAI();
    if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) {
      ball.dy *= -1;
    }
    if (ball.dx < 0 && ball.x - ball.radius < paddle1.x + paddle1.width && ball.y > paddle1.y && ball.y < paddle1.y + paddle1.height) {
      ball.dx *= -1;
      ball.dy += (Math.random() - 0.5) * 2;
    }
    if (ball.dx > 0 && ball.x + ball.radius > paddle2.x && ball.y > paddle2.y && ball.y < paddle2.y + paddle2.height) {
      ball.dx *= -1;
      ball.dy += (Math.random() - 0.5) * 2;
    }
    if (ball.x < 0) {
      pongScore.player2++;
      resetBall();
    }
    if (ball.x > canvas.width) {
      pongScore.player1++;
      resetBall();
    }
    document.getElementById('pong-score').textContent = `Player: ${pongScore.player1} - AI: ${pongScore.player2}`;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'white';
    ctx.fillRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
    ctx.fillRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fillStyle = 'white';
    ctx.fill();
    ctx.closePath();
  }
  function resetBall() {
    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;
    ball.dx = (Math.random() > 0.5 ? 1 : -1) * 4;
    ball.dy = (Math.random() > 0.5 ? 1 : -1) * 4;
  }
  pongGame = setInterval(updatePong, 1000 / 60);
}
function openGameUrl(url) {
  const browser = document.getElementById('browser');
  const frame = document.getElementById('browserFrame');
  const urlBar = document.getElementById('urlBar');
  browser.style.display = 'block';
  frame.src = url;
  urlBar.value = url;
}
function openAppUrl(url) {
  const browser = document.getElementById('browser');
  const frame = document.getElementById('browserFrame');
  const urlBar = document.getElementById('urlBar');
  browser.style.display = 'block';
  frame.src = url;
  urlBar.value = url;
}
function installApp(appName) {
  const appCard = document.querySelector(`.app-card[onclick*="${appName}"]`);
  if (appCard) {
    const installBtn = appCard.querySelector('.install-btn');
    installBtn.textContent = 'Installing...';
    installBtn.disabled = true;
    setTimeout(() => {
      installBtn.textContent = 'Installed';
      const launcher = document.getElementById('launcher');
      const launcherItem = document.createElement('div');
      launcherItem.className = 'launcher-item';
      switch (appName) {
        case 'minecraft':
          launcherItem.onclick = () => openGameUrl('https://eaglercraft.com/mc/1.8.8/');
          break;
        case 'pinkynes':
          launcherItem.onclick = () => openGameUrl('https://koute.github.io/pinky-web/');
          break;
        case 'quake':
          launcherItem.onclick = () => openGameUrl('https://www.netquake.io/');
          break;
        case 'pvz':
          launcherItem.onclick = () => openGameUrl('https://roblnet13.github.io/pvz/game/iframe.html');
          break;
        case 'doom':
          launcherItem.onclick = () => openGameUrl('https://ustymukhman.github.io/webDOOM/public/');
          break; 
        case 'flappybird':
          launcherItem.onclick = () => openGameUrl('https://flappy-bird-web.appspot.com/');
          break;
        case 'gamesnacks':
          launcherItem.onclick = () => openGameUrl('https://gamesnacks.com/');
          break;
        case 'mine':
          launcherItem.onclick = () => openGameUrl('https://googlminesweeper.com/game/index.html');
          break;
        case 'halflife':
          launcherItem.onclick = () => openGameUrl('https://x8bitrain.github.io/webXash/');
          break;
        case 'pman':
          launcherItem.onclick = () => openGameUrl('https://masonicgit.github.io/pacman/');
          break;
        case 'entanglement':
          launcherItem.onclick = () => openGameUrl('https://entanglement.gopherwoodstudios.com/en-US-index.html');
          break;
        case 'poppit':
          launcherItem.onclick = () => openGameUrl('https://www.poppit.org/game.php');
          break;
        case 'drbeta':
          launcherItem.onclick = () => openGameUrl('https://dynaroblox-beta.on.websim.com/');
          break;  
        case 'fnaf':
          launcherItem.onclick = () => openGameUrl('https://dorukyum.github.io/FNAF-Web/');
          break;
        case 'fnaf2':
          launcherItem.onclick = () => openGameUrl('https://ruihq.github.io/FNAF2/');
          break;
        case 'djump':
          launcherItem.onclick = () => openGameUrl('https://erfanbagheri404.github.io/Doodle-Jump/');
          break;
        case 'chromehead':
          launcherItem.onclick = () => openAppUrl('https://browser.rammerhead.org/');
          break;
        case 'epiktube':
          launcherItem.onclick = () => openAppUrl('http://www.epiktube.xyz/');
          break;
        case 'maps':
          launcherItem.onclick = () => openAppUrl('https://www.openstreetmap.org/export/embed');
          break;
        case 'marker':
          launcherItem.onclick = () => openAppUrl('https://markdownlivepreview.com/');
          break;
        case 'mms':
          launcherItem.onclick = () => openAppUrl('https://web.escargot.chat/');
          break;   
        case 'wstar':
          launcherItem.onclick = () => openAppUrl('https://mwood77.github.io/ws4kp-international/');
          break;
        case 'msg':
          launcherItem.onclick = () => openAppUrl('https://msgroom.windows96.net/');
          break;    
        case 'sketchpad':
          launcherItem.onclick = () => openAppUrl('https://thenerdguying.github.io/Sketchpad/');
          break;  
        case 'ruffleplayer':
          launcherItem.onclick = () => openAppUrl('https://thenerdguying.github.io/Ruffle-Player/');
          break;
        case 'slideshow':
          launcherItem.onclick = () => openAppUrl('https://thenerdguying.github.io/Slideshow/');
          break;
        case 'ugmsearch':
          launcherItem.onclick = () => openAppUrl('https://thenerdguying.github.io/Ungoogled-Memphis/');
          break;
        default:
          launcherItem.onclick = () => toggleApp(appName);
      }
      launcherItem.innerHTML = `
        <img src="Assets/Package Installer.png">
        ${appName.charAt(0).toUpperCase() + appName.slice(1)}
      `;
      launcher.appendChild(launcherItem);
    }, 2000);
  }
}
function handleTerminalInput(event) {
  if (event.key === 'Enter') {
    const input = event.target.value.trim();
    if (input) {
      executeCommand(input);
      commandHistory.push(input);
      historyIndex = commandHistory.length;
      event.target.value = '';
    }
  } else if (event.key === 'ArrowUp') {
    event.preventDefault();
    if (historyIndex > 0) {
      historyIndex--;
      event.target.value = commandHistory[historyIndex];
    }
  } else if (event.key === 'ArrowDown') {
    event.preventDefault();
    if (historyIndex < commandHistory.length - 1) {
      historyIndex++;
      event.target.value = commandHistory[historyIndex];
    } else {
      historyIndex = commandHistory.length;
      event.target.value = '';
    }
  }
}
function writeToTerminal(text) {
  const output = document.getElementById('terminal-output');
  const prompt = document.querySelector('.terminal-prompt');
  output.innerHTML += `<div class="terminal-output">${prompt.textContent} ${text}</div>`;
  output.innerHTML += text !== '' ? `<div class="terminal-output">${text}</div>` : '';
  output.scrollTop = output.scrollHeight;
}
function executeCommand(command) {
  const args = command.split(' ');
  const cmd = args[0].toLowerCase();
  switch (cmd) {
    case 'clear':
      document.getElementById('terminal-output').innerHTML = '';
      break;
    case 'echo':
      writeToTerminal(args.slice(1).join(' '));
      break;
    case 'ls':
      const files = Object.keys(fileSystem).map(folder => ({
        name: folder,
        type: 'dir'
      })).concat(fileSystem[currentDirectory.replace('~', 'Documents')]?.map(f => ({
        name: f.name,
        type: 'file'
      })) || []);
      writeToTerminal(files.map(f => `${f.type === 'dir' ? '\x1b[34m' : ''}${f.name}${f.type === 'dir' ? '/' : ''}`).join('\n'));
      break;
    case 'cd':
      const newDir = args[1] || '~';
      if (newDir === '~' || Object.keys(fileSystem).includes(newDir)) {
        currentDirectory = newDir;
        document.querySelector('.terminal-prompt').textContent = `guest@rhapmiumos:${currentDirectory}$`;
      } else {
        writeToTerminal(`bash: cd: ${newDir}: No such file or directory`);
      }
      break;
    case 'pwd':
      writeToTerminal(`/home/guest${currentDirectory === '~' ? '' : '/' + currentDirectory}`);
      break;
    case 'date':
      writeToTerminal(new Date().toString());
      break;
    case 'whoami':
      writeToTerminal('guest');
      break;
    case 'help':
      writeToTerminal('Available commands:\n' + 'clear - Clear terminal output\n' + 'echo [text] - Display text\n' + 'ls - List directory contents\n' + 'cd [dir] - Change directory\n' + 'pwd - Print working directory\n' + 'date - Show current date/time\n' + 'whoami - Show current user\n' + 'help - Show this help message');
      break;
    default:
      writeToTerminal(`bash: ${cmd}: command not found`);
  }
}
function initPaint() {
  const canvas = document.getElementById('paint-canvas');
  paintCtx = canvas.getContext('2d');
  paintCtx.lineCap = 'round';
  paintCtx.lineJoin = 'round';
  canvas.addEventListener('mousedown', startPainting);
  canvas.addEventListener('mousemove', paint);
  canvas.addEventListener('mouseup', stopPainting);
  canvas.addEventListener('mouseleave', stopPainting);
}
function startPainting(e) {
  isPainting = true;
  paint(e);
}
function stopPainting() {
  isPainting = false;
  paintCtx.beginPath();
}
function paint(e) {
  if (!isPainting) return;
  const canvas = document.getElementById('paint-canvas');
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  paintCtx.lineWidth = brushSize;
  paintCtx.strokeStyle = currentTool === 'eraser' ? '#FFFFFF' : paintColor;
  paintCtx.lineTo(x, y);
  paintCtx.stroke();
  paintCtx.beginPath();
  paintCtx.moveTo(x, y);
}
function setPaintTool(tool) {
  currentTool = tool;
}
function updatePaintColor(color) {
  paintColor = color;
}
function updateBrushSize(size) {
  brushSize = size;
}
function clearCanvas() {
  const canvas = document.getElementById('paint-canvas');
  paintCtx.clearRect(0, 0, canvas.width, canvas.height);
}
function savePainting() {
  const canvas = document.getElementById('paint-canvas');
  const dataUrl = canvas.toDataURL();
  const link = document.createElement('a');
  link.download = 'painting.png';
  link.href = dataUrl;
  link.click();
}
function exportFiles() {
  const filesData = {
    fileSystem,
    currentFolder,
    sidebarSelected
  };
  const blob = new Blob([JSON.stringify(filesData)], {
    type: 'application/json'
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'my_files.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
function reloadHtmlPreview(btn) {
  const iframe = btn.closest('.viewer-content').querySelector('iframe');
  iframe.src = iframe.src;
}
function toggleHtmlSource(btn) {
  const content = btn.closest('.viewer-content');
  const iframe = content.querySelector('iframe');
  const source = content.querySelector('.html-source');
  if (iframe.style.display !== 'none') {
    iframe.style.display = 'none';
    source.style.display = 'block';
    btn.textContent = 'View Preview';
  } else {
    iframe.style.display = 'block';
    source.style.display = 'none';
    btn.textContent = 'View Source';
  }
}
async function handleGDriveDownload(file) {
  try {
    const fileObj = {
      id: generateRandomId(),
      name: file.name,
      type: file.type,
      size: file.size,
      extension: '.' + file.name.split('.').pop().toLowerCase(),
      lastModified: new Date(),
      content: file
    };
    const extension = fileObj.extension.toLowerCase();
    if (SUPPORTED_FILE_TYPES.images.includes(extension)) {
      fileSystem.Pictures.unshift(fileObj);
    } else if (SUPPORTED_FILE_TYPES.media.includes(extension)) {
      fileSystem.Music.unshift(fileObj);
    } else if (['.txt', '.md', '.csv', '.rtf', '.pdf', '.html', '.htm', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'].includes(extension)) {
      fileSystem.Documents.unshift(fileObj);
    } else {
      fileSystem.Downloads.unshift(fileObj);
    }
    if (document.getElementById('files').style.display === 'block') {
      renderFiles();
    }
    saveState();
    return true;
  } catch (error) {
    console.error('Error handling Google Drive download:', error);
    return false;
  }
}
window.addEventListener('message', async event => {
  if (event.data && event.data.type === 'GDRIVE_DOWNLOAD') {
    const success = await handleGDriveDownload(event.data.file);
    event.source.postMessage({
      type: 'GDRIVE_DOWNLOAD_COMPLETE',
      success
    }, '*');
  }
});
function toggleFullscreen(appId) {
  const app = document.getElementById(appId);
  const taskbar = document.querySelector('.taskbar');
  if (!fullscreenApps.has(appId)) {
    app.classList.add('fullscreen');
    taskbar.classList.add('hidden');
    fullscreenApps.add(appId);
    const iframe = app.querySelector('iframe');
    if (iframe) {
      iframe.style.height = 'calc(100vh - 32px)';
    }
    const canvas = app.querySelector('canvas');
    if (canvas) {
      canvas.style.maxHeight = 'calc(100vh - 80px)';
      canvas.style.maxWidth = '100vw';
    }
  } else {
    app.classList.remove('fullscreen');
    fullscreenApps.delete(appId);
    if (fullscreenApps.size === 0) {
      taskbar.classList.remove('hidden');
    }
    const iframe = app.querySelector('iframe');
    if (iframe) {
      iframe.style.height = 'calc(100% - 32px)';
    }
    const canvas = app.querySelector('canvas');
    if (canvas) {
      canvas.style.maxHeight = '';
      canvas.style.maxWidth = '';
    }
  }
}</script>

</body></html>
